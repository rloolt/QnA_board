<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>회원가입</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="page">
    <div class="panel">
      <form class="form-vertical" action="/register" method="POST" onsubmit="return validateForm()">
        
        <div class="regist_info">ID를 입력하세요.</div>
        <div style="display: flex; gap: 10px; margin-bottom: 5px;">
            <input class="input" name="id" id="user_id" style="flex: 1;" required />
            <button type="button" class="btn" onclick="checkDuplicate()">중복 확인</button>
        </div>
        <div id="id_check_msg" style="font-size: 12px; margin-bottom: 15px;"></div>

        <div class="regist_info">PW를 입력하세요.</div>
        <input class="input wide" type="password" name="pw" required />

        <div class="regist_info">이름을 입력하세요.</div>
        <input class="input wide" name="name" required />

        <div class="regist_info">성별을 선택하세요.</div>
        <div style="margin: 10px 0; display: flex; gap: 20px;">
            <label><input type="radio" name="gender" value="남성" checked> 남성</label>
            <label><input type="radio" name="gender" value="여성"> 여성</label>
        </div>

        <div class="regist_info">생년월일을 입력하세요.</div>
        <input class="input wide" type="date" name="birthdate" required />

        <div class="regist_info">학교를 입력하세요.</div>
        <input class="input wide" name="school" required />

        <div class="actions right" style="margin-top: 20px;">
          <button class="btn" type="submit">회원가입</button>
          <a class="btn" href="{{ url_for('login') }}">로그인</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    let isIdChecked = false;

    function checkDuplicate() {
        const userId = document.getElementById('user_id').value;
        if (!userId) {
            alert("아이디를 입력해주세요.");
            return;
        }

        fetch('/check_id', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: userId })
        })
        .then(response => response.json())
        .then(data => {
            const msgElement = document.getElementById('id_check_msg');
            if (data.result === "success") {
                msgElement.innerText = data.message;
                msgElement.style.color = "blue";
                isIdChecked = true;
            } else {
                msgElement.innerText = data.message;
                msgElement.style.color = "red";
                isIdChecked = false;
            }
        });
    }

    // 아이디 입력창 내용이 바뀌면 다시 중복확인 하도록 리셋
    document.getElementById('user_id').oninput = function() {
        isIdChecked = false;
        document.getElementById('id_check_msg').innerText = "";
    };

    function validateForm() {
        if (!isIdChecked) {
            alert("아이디 중복 확인을 해주세요.");
            return false;
        }
        return true;
    }
  </script>
</body>
</html>